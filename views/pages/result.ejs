<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
    <%- include('../partials/head'); %>
    <meta property="og:title" content="R√©sultat du jeu du pendu" />
    <meta property="og:description" content="J'ai obtenu un score dans le jeu du pendu !" />
    <meta property="og:image" content="<%= imageUrl %>" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="<%= baseUrl %>/result" />
    <title>R√©sultat du jeu du pendu</title>
</head>
<body class="h-full bg-gray-300 text-gray-800">
<div class="flex items-center justify-center h-full w-full">
    <div class="game-container flex flex-col h-full w-full sm:h-auto max-h-[852px] max-w-[440px] bg-white sm:shadow-lg sm:rounded-2xl">
        <!-- En-t√™te -->
        <header class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 sm:rounded-t-2xl">
            <h1 id="result-message" class="text-4xl font-bold text-center mb-4"></h1>
        </header>

        <!-- Contenu principal -->
        <main class="flex-grow container mx-auto px-4 py-8">
            <!-- Mot √† deviner -->
            <section class="mb-8">
                <h2 class="text-xl font-semibold text-gray-700 text-center mb-2">Le mot √©tait :</h2>
                <p id="word" class="text-3xl font-bold text-center text-blue-600"></p>
            </section>

            <!-- Score -->
            <section class="mb-8">
                <h2 class="text-xl font-semibold text-gray-700 text-center mb-2">Votre score :</h2>
                <p id="score" class="text-4xl font-bold text-center text-red-500"></p>
            </section>

            <!-- Boutons d'action -->
            <div class="text-center space-y-4">
                <button onclick="shareScore()" class="bg-green-500 text-white py-2 px-4 rounded-lg shadow hover:bg-green-600 transition-colors">
                    Partager mon score
                </button>
                <a href="/" onclick="resetGame(event)" class="inline-block bg-blue-500 text-white py-2 px-4 rounded-lg shadow hover:bg-blue-600 transition-colors">
                    Rejouer
                </a>
            </div>
        </main>

        <!-- Pied de page -->
        <footer class="bg-gray-800 text-gray-400 text-center py-4 sm:rounded-b-2xl">
            <p class="text-sm">Merci d'avoir jou√© au jeu du pendu !</p>
        </footer>
    </div>
</div>

<script>
    // D√©coder les donn√©es en base64 au chargement de la page
    window.onload = function () {
        const params = new URLSearchParams(window.location.search);
        const data = params.get('data');

        if (!data) {
            alert('Donn√©es manquantes !');
            window.location.href = '/';
            return;
        }

        let decodedData;
        try {
            decodedData = JSON.parse(atob(data));
        } catch (error) {
            console.error('Erreur lors du d√©codage des donn√©es :', error);
            window.location.href = '/';
            return;
        }

        const { word, score, result } = decodedData;

        document.querySelector('#result-message').textContent =
            result === 'win' ? 'F√©licitations, vous avez gagn√© ! üéâ' : 'Dommage, vous avez perdu ! üò¢';

        document.querySelector('#word').textContent = word;
        document.querySelector('#score').textContent = score;
    };

    // R√©initialiser le jeu
    function resetGame(event) {
        event.preventDefault();
        fetch('/api/reset', { method: 'POST' })
            .then(() => {
                window.location.href = '/';
            })
            .catch(err => console.error('Erreur lors de la r√©initialisation du jeu :', err));
    }

    // Partager le score
    function shareScore() {
        const params = new URLSearchParams(window.location.search);
        const data = params.get('data');

        if (!data) {
            alert('Donn√©es manquantes pour le partage.');
            return;
        }

        const shareUrl = `${window.location.origin}/result?data=${data}`;

        if (navigator.share) {
            navigator
                .share({
                    title: 'Mon score au jeu du pendu',
                    text: "Regardez mon score ! üéâ",
                    url: shareUrl,
                })
                .then(() => console.log('Score partag√© avec succ√®s !'))
                .catch(err => console.error('Erreur lors du partage :', err));
        } else {
            alert("Le partage n'est pas pris en charge sur cet appareil ou ce navigateur.");
        }
    }
</script>

<!-- Styles pour la pleine hauteur sur mobile -->
<style>
    @media (max-width: 640px) {
        .game-container {
            height: 100vh;
            max-height: 100vh;
        }
    }
</style>
</body>
</html>
